name: Deploy site on DigitalOcean App Platform

on:
  push:
    branches:
      - deploy
  workflow_dispatch:

jobs:
  create-envfile:
    runs-on: ubuntu-latest

    steps:
      - name: Create .env ðŸ¤«
        # uses: DeveloperRic/action-create-env@v1.0.2
        run:
          touch .enviroment
          # CI_ENVIRONMENT = development
          # app.baseURL = 'https://urchin-app-u8sx2.ondigitalocean.app/'
          # app_baseURL = 'https://urchin-app-u8sx2.ondigitalocean.app/'
          # database.default.hostname = 24.199.106.12
          # database.default.database = efpem_lms
          # database.default.username = admin
          # ENCRYPTION_SALT = 37f92da155a27424f3ad

  build:
    runs-on: ubuntu-latest

    steps:
      - uses: jwsi/secret-parser@v1
        with:
          filename: .env
          secret-name: DB_HOSTNAME
          secret-value: ${{ secrets.DB_HOSTNAME }}

      - name: DigitalOcean App Platform deployment
        uses: digitalocean/app_action@v1.1.5
        with:
          app_name: urchin-app
          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}

      - uses: actions/checkout@v2
